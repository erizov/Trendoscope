# üé§ TTS Phase 2 Plan - Caching & Offline Mode

## Overview

–§–∞–∑–∞ 2: –£–ª—É—á—à–µ–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **–±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö** —Å–µ—Ä–≤–∏—Å–æ–≤.

---

## üéØ Goals

1. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
2. ‚úÖ –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Å pyttsx3 (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º

---

## üìã Phase 2 Features

### 1. Enhanced Caching

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ë–∞–∑–æ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚è≠Ô∏è –ù—É–∂–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

**–£–ª—É—á—à–µ–Ω–∏—è:**
- –ö—ç—à –ø–æ —Ö—ç—à—É —Ç–µ–∫—Å—Ç–∞ + —è–∑—ã–∫ + –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- TTL (Time To Live) –¥–ª—è –∫—ç—à–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞

### 2. Offline Mode (pyttsx3)

**–ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** `pyttsx3` (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)

**–§—É–Ω–∫—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤
- –†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –ø—Ä–∏ –æ—à–∏–±–∫–µ gTTS
- –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ –ø–æ –ø–æ–ª—É (–≥–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ö–∞—á–µ—Å—Ç–≤–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤
- Windows: SAPI5 voices
- Linux: espeak –∏–ª–∏ festival
- macOS: NSSpeechSynthesizer

### 3. Smart Provider Selection

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å gTTS (–µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
2. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ pyttsx3
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä –≤—Ä—É—á–Ω—É—é

---

## üì¶ Dependencies

### New Dependency (FREE)

```txt
pyttsx3>=2.90  # Offline TTS (system voices)
```

**–í–æ–ø—Ä–æ—Å:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `pyttsx3` —Å–µ–π—á–∞—Å? (–≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Docker)

---

## üèóÔ∏è Implementation Plan

### Step 1: Create pyttsx3 Provider

**File:** `trendoscope2/src/trendoscope2/tts/pyttsx3_provider.py`

**Features:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ TTS
- –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ –ø–æ –ø–æ–ª—É (–≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ –≤ WAV/MP3
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Step 2: Update TTS Service

**File:** `trendoscope2/src/trendoscope2/tts/tts_service.py`

**Changes:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É pyttsx3 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
- –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (gtts/pyttsx3/auto)

### Step 3: Enhanced Caching

**Improvements:**
- TTL –¥–ª—è –∫—ç—à–∞ (30 –¥–Ω–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Step 4: Update API

**New Options:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `provider` –≤ API (gtts/pyttsx3/auto)
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ –≤ –æ—Ç–≤–µ—Ç–µ
- –°—Ç–∞—Ç—É—Å –æ—Ñ–ª–∞–π–Ω/–æ–Ω–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞

### Step 5: Update Frontend

**New Features:**
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–æ–Ω–ª–∞–π–Ω/–æ—Ñ–ª–∞–π–Ω)
- –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ fallback

---

## üìã File Structure

```
trendoscope2/src/trendoscope2/tts/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ tts_service.py          # Updated with fallback
‚îú‚îÄ‚îÄ gtts_provider.py        # Existing
‚îî‚îÄ‚îÄ pyttsx3_provider.py    # NEW - Offline provider
```

---

## üîß Configuration

### Environment Variables

```env
# TTS Configuration
TTS_PROVIDER=auto          # gtts, pyttsx3, auto
TTS_CACHE_ENABLED=true
TTS_CACHE_TTL_DAYS=30
TTS_FALLBACK_ENABLED=true  # Auto fallback to offline
```

### Config Updates

```python
# config.py
TTS_PROVIDER: str = os.getenv('TTS_PROVIDER', 'auto')
TTS_FALLBACK_ENABLED: bool = os.getenv('TTS_FALLBACK_ENABLED', 'true').lower() == 'true'
TTS_CACHE_TTL_DAYS: int = int(os.getenv('TTS_CACHE_TTL_DAYS', '30'))
```

---

## üéØ Implementation Steps

### Step 1: Install pyttsx3 (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

**–í–æ–ø—Ä–æ—Å:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `pyttsx3>=2.90`? (–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Docker)

–ï—Å–ª–∏ –¥–∞:
```bash
pip install pyttsx3>=2.90
```

### Step 2: Create pyttsx3 Provider

–°–æ–∑–¥–∞—Ç—å `pyttsx3_provider.py` —Å:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ TTS
- –í—ã–±–æ—Ä–æ–º –≥–æ–ª–æ—Å–∞
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∞—É–¥–∏–æ

### Step 3: Update TTS Service

–î–æ–±–∞–≤–∏—Ç—å:
- –ü–æ–¥–¥–µ—Ä–∂–∫—É pyttsx3
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
- –õ–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

### Step 4: Enhanced Caching

–î–æ–±–∞–≤–∏—Ç—å:
- TTL –¥–ª—è —Ñ–∞–π–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

### Step 5: Update API & Frontend

–î–æ–±–∞–≤–∏—Ç—å:
- –ü–∞—Ä–∞–º–µ—Ç—Ä provider
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏

---

## ‚ö†Ô∏è Important Notes

### pyttsx3 Requirements

**Windows:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SAPI5 (–≤—Å—Ç—Ä–æ–µ–Ω–æ –≤ Windows)
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤

**Linux:**
- –¢—Ä–µ–±—É–µ—Ç `espeak` –∏–ª–∏ `festival`
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞: `sudo apt-get install espeak` –∏–ª–∏ `sudo apt-get install festival`

**macOS:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç NSSpeechSynthesizer (–≤—Å—Ç—Ä–æ–µ–Ω–æ)
- –†–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏

### Audio Format

- pyttsx3 –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç WAV
- –ù—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ MP3 –¥–ª—è –≤–µ–± (–∏—Å–ø–æ–ª—å–∑—É–µ–º pydub)

---

## üß™ Testing Plan

### Test 1: Offline Mode
1. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å TTS
3. –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è pyttsx3

### Test 2: Fallback
1. –°—ã–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É gTTS
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### Test 3: Voice Selection
1. –í—ã–±—Ä–∞—Ç—å –º—É–∂—Å–∫–æ–π/–∂–µ–Ω—Å–∫–∏–π –≥–æ–ª–æ—Å
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ pyttsx3 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–æ–ª–æ—Å

### Test 4: Caching
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## ‚úÖ Success Criteria

- [ ] pyttsx3 –ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
- [ ] –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–≥–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
- [ ] Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

## üöÄ Ready to Implement?

**–í–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º:**

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pyttsx3?** (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Docker)
   - –û—Ç–≤–µ—Ç: –î–∞/–ù–µ—Ç

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker?** (–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è pyttsx3)
   - –û—Ç–≤–µ—Ç: –ù–µ—Ç, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

3. **–ù–∞—á–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é?**
   - –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞—á–Ω—É —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

---

**–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ!** ‚úÖ

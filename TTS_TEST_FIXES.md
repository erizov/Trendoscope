# üîß TTS Test Fixes

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ —Ç–µ—Å—Ç–∞—Ö TTS

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **–ü—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –≤–º–µ—Å—Ç–æ 400/422**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** FastAPI –Ω–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ `Body(...)`
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ Pydantic –º–æ–¥–µ–ª—å `TTSGenerateRequest` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:
     - `min_length=1` –¥–ª—è –ø–æ–ª—è `text`
     - –ö–∞—Å—Ç–æ–º–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä `validate_text_not_empty()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ `strip()`
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 422 (Validation Error) –¥–ª—è –ø—É—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

2. **–¢–∞–π–º–∞—É—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∂–µ–Ω—Å–∫–æ–≥–æ –≥–æ–ª–æ—Å–∞ (pyttsx3)**
   - **–ü—Ä–æ–±–ª–µ–º–∞:** `engine.runAndWait()` –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
   - **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è `runAndWait()`:
     - –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 30 —Å–µ–∫—É–Ω–¥
     - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ —Ç–∞–π–º–∞—É—Ç–∞
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π

### üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**`api/main.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `pydantic.BaseModel`, `Field`, `field_validator`
- –°–æ–∑–¥–∞–Ω–∞ –º–æ–¥–µ–ª—å `TTSGenerateRequest` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω endpoint `/api/tts/generate` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏

**`tts/pyttsx3_provider.py`:**
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è `runAndWait()` —á–µ—Ä–µ–∑ threading
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–æ–≤

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 422 (Validation Error)
- ‚úÖ pyttsx3 –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∑–∞–≤–∏—Å–∞–Ω–∏–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2024
